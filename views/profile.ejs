<% include ./partials/header.ejs %>

  <div class="w-full min-h-screen bg-zinc-900 text-white py-6 overflow-hidden">
    <!-- Navbar -->
    <div class="nav flex justify-between items-center px-5 sm:px-8 md:px-12">
      <h3 class="text-md sm:text-lg font-semibold tracking-tight capitalize">
        <%= user.username %>
      </h3>
      <div class="icons flex gap-5 text-[1.4rem]">
        <a href="/save/posts" class="hover:text-sky-400 transition"><i class="ri-save-2-fill"></i></a>
        <a href="/upload" class="hover:text-blue-400 transition"><i class="ri-add-box-line"></i></a>
        <a href="/story/add" class="hover:text-blue-400 transition"><i class="ri-add-circle-line"></i></a>
      </div>
    </div>

    <!-- Profile Section -->
    <div class="flex flex-col md:flex-row md:justify-between items-center px-6 md:px-16 mt-8 gap-8">
      <div class="w-36 h-36 sm:w-44 sm:h-44 md:w-52 md:h-52 rounded-full overflow-hidden bg-sky-100">
        <img src="data:<%= user.profileImage.contentType %>;base64,<%= user.profileImage.data?.toString('base64') %>" alt="Profile Image" class="w-full h-full object-cover">
      </div>

      <div class="stats flex gap-8 sm:gap-12 md:gap-16 text-center">
        <div>
          <h3 class="text-lg sm:text-xl font-semibold">
            <%= user.posts.length %>
          </h3>
          <h4 class="opacity-70 text-sm sm:text-base">Posts</h4>
        </div>
        <div>
          <h3 class="text-lg sm:text-xl font-semibold">
            <%= user.followers.length %>
          </h3>
          <h4 class="opacity-70 text-sm sm:text-base">Followers</h4>
        </div>
        <div>
          <h3 class="text-lg sm:text-xl font-semibold">
            <%= user.following.length %>
          </h3>
          <h4 class="opacity-70 text-sm sm:text-base">Following</h4>
        </div>
      </div>
    </div>

    <!-- Bio Section -->
    <div class="dets px-6 md:px-16 mt-6 text-center md:text-left">
      <h3 class="text-xl font-semibold mb-1 tracking-tight">
        <%= user.name %>
      </h3>
      <p class="text-sm sm:text-base tracking-tight opacity-60 max-w-xl mx-auto md:mx-0">
        <%= user.bio || "You have not set anything yet, (click edit profile to set)" %>
      </p>
    </div>

    <!-- Buttons -->
    <div class="px-6 md:px-16 mt-6 flex flex-wrap gap-3 justify-center md:justify-start">
      <a class="px-5 py-2 bg-zinc-800 text-sm sm:text-base rounded-md hover:bg-zinc-700 transition" href="/edit">
        Edit Profile
      </a>
      <a class="px-5 py-2 bg-red-500 text-sm sm:text-base rounded-md hover:bg-red-600 transition" href="/logout">
        Logout
      </a>
    </div>

    <!-- Posts Grid -->
    <div
      class="posts w-full px-6 md:px-16 mt-8 mb-10 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 sm:gap-4">
      <% if (user.posts.length> 0) { %>
        <% user.posts.forEach(post=> { %>
          <div
            class="relative group aspect-square bg-zinc-800 overflow-hidden rounded-md hover:scale-[1.02] transition-transform duration-300 ease-in-out">
            <img src="/images/uploads/<%= post.postImage %>" alt="Post"
              class="w-full h-full object-cover object-center">

            <!-- Save Icon Overlay -->
            <i class="save-btn ri-save-2-line absolute top-2 right-2 text-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 cursor-pointer hover:text-sky-400"
              data-postid="<%= post._id %>" title="Save Post">
            </i>
          </div>
          <% }) %>
            <% } else { %>
              <div class="col-span-full text-center mt-20 text-zinc-400">
                <i class="ri-image-2-line text-5xl mb-3 block"></i>
                <p>No posts uploaded yet.</p>
              </div>
              <% } %>
    </div>
  </div>

  <script>
    // Save/Unsave Post
    document.querySelectorAll('.save-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const postId = e.target.dataset.postid;

        try {
          const res = await fetch(`/save/${postId}`);
          const data = await res.json();

          if (data.savedPosts.includes(postId)) {
            e.target.classList.remove('ri-save-2-line');
            e.target.classList.add('ri-save-2-fill', 'text-sky-400');
          } else {
            e.target.classList.remove('ri-save-2-fill', 'text-sky-400');
            e.target.classList.add('ri-save-2-line');
          }
        } catch (err) {
          console.error('Error saving post:', err);
        }
      });
    });
  </script>

  <% include ./partials/footer.ejs %>