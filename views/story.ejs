<% include ./partials/header.ejs %>

    <div class="relative w-full min-h-screen bg-black flex items-center justify-center overflow-hidden">

        <!-- Progress Bars -->
        <div class="absolute top-5 left-4 right-4 flex gap-1 z-20 max-w-3xl mx-auto">
            <% if (user.stories && user.stories.length> 0) { %>
                <% user.stories.forEach((story, index)=> { %>
                    <div class="flex-1 h-[3px] bg-gray-700 rounded-full overflow-hidden">
                        <div id="bar-<%= index %>" class="w-0 h-full bg-white"></div>
                    </div>
                    <% }) %>
                        <% } else { %>
                            <div class="mx-auto text-center mt-10">
                                <h1 class="opacity-40 font-semibold text-[#dadada] text-lg">No Stories posted yet...
                                </h1>
                            </div>
                            <% } %>
        </div>

        <!-- Close Button -->
        <button onclick="window.history.back()"
            class="absolute top-5 right-5 text-white text-3xl z-20 hover:text-gray-300 transition">
            <i class="ri-close-line"></i>
        </button>

        <!-- User Info -->
        <a href="/profile/" class="absolute top-12 left-4 flex items-center gap-3 z-20">
            <img src="/images/uploads/<%= user.profileImage %>"
                class="w-11 h-11 sm:w-12 sm:h-12 rounded-full border-2 border-white object-cover" alt="user">
            <span class="text-[#dadada] font-semibold capitalize text-lg sm:text-xl tracking-tight">
                <%= user.username %>
            </span>
        </a>

        <!-- Story Images -->
        <% user.stories.forEach((story, index)=> { %>
            <img src="/images/uploads/<%= story.story %>" id="story-<%= index %>" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[50%] h-full object-contain sm:object-cover transition-opacity duration-300
                                         <%= index === 0 ? 'opacity-100' : 'opacity-0' %>" alt="story">
        <% }) %>

    </>

    <script>
        const stories = document.querySelectorAll('[id^="story-"]');
        const bars = document.querySelectorAll('[id^="bar-"]');
        let current = 0;
        const duration = 5000; // 5 seconds per story

        function showStory(index) {
            stories.forEach((story, i) => {
                story.style.opacity = i === index ? '1' : '0';
            });

            bars.forEach((bar, i) => {
                bar.style.transition = 'none';
                bar.style.width = i < index ? '100%' : '0%';
            });

            setTimeout(() => {
                bars[index].style.transition = `width ${duration / 1000}s linear`;
                bars[index].style.width = '100%';
            }, 50);

            setTimeout(() => {
                if (index < stories.length - 1) showStory(index + 1);
                else window.history.back();
            }, duration);
        }

        if (stories.length > 0) showStory(current);
    </script>

    <% include ./partials/footer.ejs %>